<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–ª—É—á–∞–π–Ω—ã–π –º–µ–º —Å Pikabu üòÇ</title>
  <style>
    :root { --bg:#0b1020; --card:#121a33; --text:#e7ecff; --muted:#9fb1ff; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: radial-gradient(1000px 600px at 20% -10%, #1b2a62 0%, #0b1020 45%) fixed; color: var(--text); }
    .wrap { max-width: 900px; margin: 32px auto; padding: 20px; }
    .card { background: color-mix(in srgb, var(--card), #000 8%); border: 1px solid rgba(255,255,255,0.06); border-radius: 20px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.35); }
    h1 { margin: 0 0 8px; letter-spacing: .3px; }
    p { margin: 6px 0 18px; color: var(--muted); }
    .row { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 880px) { .row { grid-template-columns: 1.2fr .8fr; } }
    button { appearance: none; background: linear-gradient(180deg, #7aa8ff, #5e86ff); color: #fff; border: none; padding: 12px 16px; border-radius: 14px; font-weight: 700; cursor: pointer; box-shadow: 0 6px 16px rgba(94,134,255,.35); }
    button[disabled] { opacity: .6; cursor: progress; }
    .toolbar { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .imgBox { position: relative; border-radius: 16px; overflow: hidden; min-height: 320px; background: #0a0f26; border: 1px solid rgba(255,255,255,.06); display: grid; place-items: center; }
    .imgBox img { width: 100%; height: 100%; object-fit: contain; display: block; }
    .status { font-size: 14px; color: var(--muted); }
    .json { background: #0a0f26; border: 1px solid rgba(255,255,255,.06); border-radius: 12px; padding: 12px; overflow: auto; max-height: 480px; font: 12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color: #d6e1ff; }
    .hint { font-size: 12px; color: #c3d1ff; opacity: .8; margin-top: 6px; }
    code { background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .footer { opacity: .7; margin-top: 18px; font-size: 12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>–°–ª—É—á–∞–π–Ω—ã–π –º–µ–º —Å Pikabu</h1>
      <p>–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º JSON –ø–æ—Å—Ç–æ–≤ —Å Pikabu –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –º–µ–º. –¢–æ–ª—å–∫–æ HTTP –∏ JSON.</p>

      <div class="toolbar">
        <button id="btn">–ù–æ–≤—ã–π –º–µ–º üòÇ</button>
        <span class="status" id="status">–ì–æ—Ç–æ–≤–æ</span>
      </div>

      <div class="row" style="margin-top:16px;">
        <div>
          <div class="imgBox" id="imgBox">
            <span class="status">–ù–∞–∂–º–∏—Ç–µ ¬´–ù–æ–≤—ã–π –º–µ–º¬ª</span>
          </div>
          <div class="hint">API Pikabu –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CORS, –Ω–æ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∞–π—Ç–æ–≤.</div>
        </div>
        <div>
          <div class="json" id="json">{/* –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è JSON –æ—Ç–≤–µ—Ç */}</div>
        </div>
      </div>

      <div class="footer">
        <p>–ö–Ω–æ–ø–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç <code>fetch()</code> ‚Üí HTTP‚Äë–∑–∞–ø—Ä–æ—Å ‚Üí JSON ‚Üí —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ JSON.</p>
      </div>
    </div>
  </div>

  <script>
    const btn = document.getElementById('btn');
    const statusEl = document.getElementById('status');
    const imgBox = document.getElementById('imgBox');
    const jsonBox = document.getElementById('json');

    async function loadMeme() {
      btn.disabled = true;
      statusEl.textContent = '–ó–∞–≥—Ä—É–∂–∞—é‚Ä¶';
      imgBox.innerHTML = '<span class="status">–ü–æ–ª—É—á–∞–µ–º –º–µ–º‚Ä¶</span>';
      jsonBox.textContent = '';

      try {
        const resp = await fetch('https://pikabu.ru/ajax/index.php?story_type=story&limit=50');
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);

        const data = await resp.json();
        if (!data.stories || data.stories.length === 0) throw new Error('–ù–µ—Ç –ø–æ—Å—Ç–æ–≤');

        // –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Å—Ç
        const post = data.stories[Math.floor(Math.random() * data.stories.length)];

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (!post.media || post.media.length === 0) throw new Error('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–æ—Å—Ç–µ');

        // –ë–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const imgData = post.media[Math.floor(Math.random() * post.media.length)];

        const img = new Image();
        img.alt = '–°–ª—É—á–∞–π–Ω—ã–π –º–µ–º —Å Pikabu';
        img.decoding = 'async';
        img.loading = 'lazy';
        img.src = imgData.orig;
        imgBox.innerHTML = '';
        imgBox.appendChild(img);

        jsonBox.textContent = JSON.stringify(post, null, 2);
        statusEl.textContent = '–ì–æ—Ç–æ–≤–æ';
      } catch (err) {
        statusEl.textContent = '–û—à–∏–±–∫–∞';
        imgBox.innerHTML = `<span class="status">–£–ø—Å: ${err.message}</span>`;
        jsonBox.textContent = (err && err.stack) ? err.stack : String(err);
      } finally {
        btn.disabled = false;
      }
    }

    btn.addEventListener('click', loadMeme);
  </script>
</body>
</html>
